<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1 class="tarifas">Hacé tu envío</h1>
    <div class="cont-cotizador">
        <form class="cotizador" onsubmit="calcularEnvio(event)">
            <div class="origen mb-3 p-3">
                <div>
                    <label for="origen" class="mb-2">Origen</label>
                    <input type="text" id="" name="origen" placeholder="Barrio, municipio, provincia" class="input text-white" required>    
                </div>
                <div>
                    <label for="cporigen" class="mb-2">Codigo Postal</label>
                    <input type="text" id="" name="cpOrigen" placeholder="B9410" class="input-number text-white" required>        
                </div>
            </div>
            <div class="destino mb-3 p-3">
                <div>
                    <label for="destino" class="mb-2">Destino</label>
                    <input type="text" id="" name="destino" placeholder="Barrio, municipio, provincia" class="input text-white" required>    
                </div>
                <div>
                    <label for="cpdestino" class="mb-2">Codigo Postal</label>
                    <input type="text" id="" name="cpDestino" placeholder="C4650" class="input-number text-white" required>        
                </div>
            </div>
            <div class="peso mb-3 p-3">
                <div>
                    <label for="cantbultos" class="text-white">Cantidad de paquetes</label>
                    <input type="number" id="" name="cantPaquetes" class="input-number text-white" required>
                </div>
                <div>
                    <label for="kg" class="text-white">Peso (kg)</label>
                    <input type="number" step=".1" id="" name="peso" class="input-number text-white" required>
                </div>
            </div>
            <div class="pago mb-3 p-3">
                <div>
                    <h4 class="text-white fw-light">Desea pagar en</h4>
                    <div class="input-radio">
                        <input type="radio" id="payment1" name="pago" required>
                        <label for="pago1" class="text-white">Origen</label>
                    </div>
                    <div class="input-radio">
                        <input type="radio" id="payment2" name="pago" required>
                        <label for="pago2" class="text-white">Destino</label>
                    </div>
                </div>
                <div>
                    <label class="text-white" for="metodoDePago">Metodo de pago</label>
                    <select class="input" name="metodoDePago" id="" required>
                        <option value="efectivo">Efectivo</option>
                        <option value="transferencia">Transferencia</option>
                        <option value="tarjeta">Tarjeta</option>
                    </select>
                </div>
            </div> 
            <div class="imgPedido">
                <label for="imgPaquete" class="text-white">Imagen de tu pedido (opcional)</label>
                <input type="file" id="" name="" class="adjImg text-white">
            </div>
            <div>
                <button type="submit" id="" value="Enviar" class="btn-form">Enviar</button>
                <button type="reset" value="Resetear" class="btn-form">Reiniciar</button>
            </div>
        </form>
    </div>



    <script>
async function calcularEnvio(event) {
    event.preventDefault();

    // Obtener valores del formulario
    const origen = document.querySelector('input[name="origen"]').value;
    const destino = document.querySelector('input[name="destino"]').value;
    const codigoPostalOrigen = document.querySelector('input[name="cpOrigen"]').value;
    const codigoPostalDestino = document.querySelector('input[name="cpDestino"]').value;
    const cantPaquetes = parseInt(document.querySelector('input[name="cantPaquetes"]').value);
    const peso = parseFloat(document.querySelector('input[name="peso"]').value);
    const pago = document.querySelector('input[name="pago"]:checked').value;
    const metodoDePago = document.querySelector('select[name="metodoDePago"]').value;

    if (codigoPostalOrigen.length > 5 || codigoPostalDestino.length > 5) {
        Swal.fire({
        icon: 'error',
        html: `<h2 class="tituloSweet">¡Error!</h2><br><p class="pFormulario">El código postal debe tener máximo 5 caracteres</p>`,
        color: '#1b0366',
        timer: 5000,
        timerProgressBar: true,
        showConfirmButton: false,
        customClass: { popup: 'tamañoAlertSweet' }
        });
        return false;
    }

    // Valores fijos
    const precioCombustible = 1000.00; // Precio promedio de combustible en pesos argentinos

    try {
        // Geocodificación para obtener coordenadas usando Nominatim
        const coordsOrigen = await obtenerCoordenadas(origen);
        const coordsDestino = await obtenerCoordenadas(destino);

        if (!coordsOrigen ||!coordsDestino) {
        Swal.fire({
            icon: 'error',
            html: `<h2 class="tituloSweet">¡Error!</h2><br><p class="pFormulario">Error al obtener coordenadas</p>`,
            color: '#1b0366',
            timer: 5000,
            timerProgressBar: true,
            showConfirmButton: false,
            customClass: { popup: 'tamañoAlertSweet' }
        });
        return;
        }

        // Calcular la distancia usando OSRM
        const distancia = await calcularDistancia(coordsOrigen, coordsDestino);
        if (distancia === null) {
        Swal.fire({
            icon: 'error',
            html: `<h2 class="tituloSweet">¡Error!</h2><br><p class="pFormulario">Error al calcular la distancia</p>`,
            color: '#1b0366',
            timer: 5000,
            timerProgressBar: true,
            showConfirmButton: false,
            customClass: { popup: 'tamañoAlertSweet' }
        });
        return;
        }

        // Calcular costos
        const costoCombustible = distancia * precioCombustible * 0.1; // Ejemplo: 0.1 litros por km
        const costoPeajes = calcularPeajes(distancia);
        const costoTotal = (peso * cantPaquetes) + costoCombustible + costoPeajes;

        // Generar código único de envío aleatorio
        const codigoEnvio = generarCodigoEnvio();

        // Mostrar el resultado
        Swal.fire({
        icon: 'success',
        html: `<h2 class="tituloSweet">¡Completado!</h2>
        <br>
        <p>El costo de envío es:<br> ${costoTotal.toFixed(2)} pesos
        <br>
        <br>Código de envío: ${codigoEnvio}</p>`,
        color: '#1b0366',
        showConfirmButton: true,
        customClass: { popup: 'tamañoAlertSweet' }
        });
    } catch (error) {
        Swal.fire({
        icon: 'error',
        html: `<h2 class="tituloSweet">¡Error!</h2>
        <br>
        <p class="pFormulario">Ocurrió un error al calcular el costo</p>`,
        color: '#1b0366',
        timer: 5000,
        timerProgressBar: true,
        showConfirmButton: false,
        customClass: { popup: 'tamañoAlertSweet' }
        });
        console.error('Error:', error);
    }
    }

function generarCodigoEnvio() {
    const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const numeros = "0123456789";
      
    let codigoEnvio = "";
      
    // Generar 3 letras aleatorias
    for (let i = 0; i < 3; i++) {
        codigoEnvio += letras.charAt(Math.floor(Math.random() * letras.length));
    }
      
    // Generar 3 números aleatorios
    for (let i = 0; i < 3; i++) {
        codigoEnvio += numeros.charAt(Math.floor(Math.random() * numeros.length));
    }
      
    return codigoEnvio;
} 
    </script>

    <script>
        async function calcularEnvio(event) {
  event.preventDefault();

  // Obtener valores del formulario
  const origen = document.querySelector('input[name="origen"]').value;
  const destino = document.querySelector('input[name="destino"]').value;
  const codigoPostalOrigen = document.querySelector('input[name="cpOrigen"]').value;
  const codigoPostalDestino = document.querySelector('input[name="cpDestino"]').value;
  const cantPaquetes = parseInt(document.querySelector('input[name="cantPaquetes"]').value);
  const peso = parseFloat(document.querySelector('input[name="peso"]').value);
  const pago = document.querySelector('input[name="pago"]:checked').value;
  const metodoDePago = document.querySelector('select[name="metodoDePago"]').value;

  // Validar que los inputs no estén vacíos
  if (!origen || !destino || !codigoPostalOrigen || !codigoPostalDestino || !cantPaquetes || !peso || !pago || !metodoDePago) {
    Swal.fire({
      icon: 'error',
      html: `<h2 class="tituloSweet">¡Error!</h2><br><p class="pFormulario">Todos los campos son obligatorios</p>`,
      color: '#1b0366',
      timer: 5000,
      timerProgressBar: true,
      showConfirmButton: false,
      customClass: { popup: 'tamañoAlertSweet' }
    });
    return;
  }

  // Validar que los códigos postales tengan un máximo de 5 caracteres
  if (codigoPostalOrigen.length > 5 || codigoPostalDestino.length > 5) {
    Swal.fire({
      icon: 'error',
      html: `<h2 class="tituloSweet">¡Error!</h2><br><p class="pFormulario">El código postal debe tener máximo 5 caracteres</p>`,
      color: '#1b0366',
      timer: 5000,
      timerProgressBar: true,
      showConfirmButton: false,
      customClass: { popup: 'tamañoAlertSweet' }
    });
    return;
  }

  // Resto del código...
}
    </script>

</body>
</html>

